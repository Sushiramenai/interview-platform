<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Senbird Interview System - HR Dashboard</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Playfair+Display:wght@700;900&display=swap" rel="stylesheet">
    
    <!-- Icons -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Styles -->
    <link rel="stylesheet" href="/css/design-system.css">
    <style>
        /* Page Specific Styles */
        body {
            background: linear-gradient(135deg, var(--sage-whisper) 0%, var(--white) 50%, var(--sage-whisper) 100%);
            min-height: 100vh;
            position: relative;
        }
        
        body::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 100vh;
            background: radial-gradient(ellipse at top left, rgba(107, 142, 90, 0.05) 0%, transparent 50%),
                        radial-gradient(ellipse at bottom right, rgba(159, 181, 149, 0.05) 0%, transparent 50%);
            pointer-events: none;
            z-index: 0;
        }
        
        /* Header Styles - Premium Glass Effect */
        .platform-header {
            background: linear-gradient(to bottom, rgba(255, 255, 255, 0.9), rgba(232, 240, 230, 0.7));
            backdrop-filter: blur(20px) saturate(180%);
            padding: var(--space-md) 0;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 4px 30px rgba(107, 142, 90, 0.08);
            border-bottom: 1px solid rgba(159, 181, 149, 0.2);
        }
        
        /* Dashboard Layout */
        .dashboard-layout {
            display: flex;
            gap: var(--space-xl);
            max-width: 1400px;
            margin: 0 auto;
            padding: var(--space-xl) var(--space-lg);
        }
        
        /* Sidebar Navigation - Premium Design */
        .sidebar-nav {
            width: 240px;
            background: linear-gradient(145deg, var(--white), rgba(232, 240, 230, 0.3));
            border-radius: var(--radius-lg);
            padding: var(--space-lg);
            box-shadow: var(--shadow-premium);
            height: fit-content;
            position: sticky;
            top: 100px;
            border: 1px solid rgba(159, 181, 149, 0.15);
            overflow: hidden;
        }
        
        .sidebar-nav::before {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(159, 181, 149, 0.1) 0%, transparent 70%);
            pointer-events: none;
        }
        
        .nav-item {
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            padding: var(--space-md) var(--space-lg);
            margin-bottom: var(--space-xs);
            border-radius: var(--radius-md);
            cursor: pointer;
            transition: all var(--transition-base);
            color: var(--dark-70);
            font-weight: 500;
        }
        
        .nav-item:hover {
            background: var(--light);
            color: var(--primary);
        }
        
        .nav-item.active {
            background: linear-gradient(135deg, var(--primary), var(--primary-light));
            color: var(--white);
            box-shadow: 0 4px 20px rgba(107, 142, 90, 0.4);
            position: relative;
            overflow: hidden;
        }
        
        .nav-item.active::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            animation: shimmer 3s infinite;
        }
        
        @keyframes shimmer {
            to { left: 100%; }
        }
        
        .nav-item i {
            width: 20px;
            text-align: center;
        }
        
        /* Main Content Area - Premium Cards */
        .main-content {
            flex: 1;
            position: relative;
            z-index: 1;
        }
        
        .content-section {
            background: linear-gradient(145deg, var(--white), rgba(255, 255, 255, 0.95));
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            box-shadow: var(--shadow-premium);
            margin-bottom: var(--space-xl);
            display: none;
            border: 1px solid rgba(159, 181, 149, 0.1);
            position: relative;
            overflow: hidden;
        }
        
        .content-section::before {
            content: '';
            position: absolute;
            top: 0;
            right: 0;
            width: 300px;
            height: 300px;
            background: radial-gradient(circle, var(--sage-whisper) 0%, transparent 70%);
            opacity: 0.5;
            pointer-events: none;
        }
        
        .content-section.active {
            display: block;
        }
        
        /* Quick Actions Bar - Award-Winning Gradient */
        .quick-actions {
            background: linear-gradient(135deg, var(--forest-depth) 0%, var(--primary-light) 100%);
            color: var(--white);
            padding: var(--space-lg) var(--space-xl);
            border-radius: var(--radius-lg);
            margin-bottom: var(--space-xl);
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: relative;
            overflow: hidden;
            box-shadow: var(--shadow-ambient);
        }
        
        .quick-actions::after {
            content: '';
            position: absolute;
            top: -50%;
            right: -50%;
            width: 200%;
            height: 200%;
            background: radial-gradient(circle, rgba(255, 255, 255, 0.1) 0%, transparent 40%);
            animation: rotate 20s linear infinite;
        }
        
        @keyframes rotate {
            to { transform: rotate(360deg); }
        }
        
        .quick-actions h3 {
            margin: 0;
            font-size: 1.25rem;
        }
        
        .quick-actions p {
            margin: 0;
            opacity: 0.9;
            font-size: 0.875rem;
        }
        
        /* Template Cards */
        .template-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(380px, 1fr));
            gap: var(--space-xl);
        }
        
        .template-card {
            background: var(--white);
            border: 2px solid var(--dark-05);
            border-radius: var(--radius-lg);
            padding: var(--space-xl);
            transition: all var(--transition-base);
            cursor: pointer;
            position: relative;
            overflow: hidden;
        }
        
        .template-card:hover {
            border-color: var(--primary-light);
            box-shadow: 0 12px 40px rgba(107, 142, 90, 0.2);
            transform: translateY(-4px) scale(1.02);
            background: linear-gradient(145deg, var(--white), var(--sage-whisper));
        }
        
        .template-card-header {
            margin-bottom: var(--space-md);
        }
        
        .template-card-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: var(--dark);
            margin-bottom: var(--space-xs);
        }
        
        .template-card-meta {
            display: flex;
            gap: var(--space-lg);
            margin-bottom: var(--space-md);
            font-size: 0.875rem;
            color: var(--dark-50);
        }
        
        .template-card-description {
            color: var(--dark-70);
            font-size: 0.875rem;
            line-height: 1.6;
            margin-bottom: var(--space-lg);
        }
        
        .template-card-actions {
            display: flex;
            gap: var(--space-sm);
            justify-content: flex-end;
            padding-top: var(--space-md);
            border-top: 1px solid var(--dark-05);
        }
        
        /* Interview Modal */
        .interview-modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        
        .interview-modal.active {
            display: flex;
        }
        
        .interview-modal-content {
            background: var(--white);
            border-radius: var(--radius-xl);
            padding: var(--space-2xl);
            max-width: 500px;
            width: 90%;
            box-shadow: var(--shadow-xl);
        }
        
        /* Stats Widget */
        .stats-widget {
            display: flex;
            gap: var(--space-xl);
            margin-bottom: var(--space-xl);
        }
        
        .stat-item {
            flex: 1;
            text-align: center;
            padding: var(--space-lg);
            background: var(--light);
            border-radius: var(--radius-md);
        }
        
        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary);
        }
        
        .stat-label {
            font-size: 0.875rem;
            color: var(--dark-50);
            margin-top: var(--space-xs);
        }
        
        /* Interview List */
        .interview-list {
            display: flex;
            flex-direction: column;
            gap: var(--space-md);
        }
        
        .interview-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: var(--space-lg);
            background: var(--light);
            border-radius: var(--radius-md);
            transition: all var(--transition-base);
        }
        
        .interview-item:hover {
            background: var(--white);
            box-shadow: var(--shadow-sm);
        }
        
        /* Settings Form - Premium Sections */
        .settings-group {
            margin-bottom: var(--space-2xl);
            padding: var(--space-xl);
            background: linear-gradient(145deg, rgba(232, 240, 230, 0.2), transparent);
            border-radius: var(--radius-md);
            border: 1px solid rgba(159, 181, 149, 0.15);
            position: relative;
        }
        
        .settings-group::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            height: 1px;
            background: linear-gradient(90deg, transparent, var(--primary-light), transparent);
            opacity: 0.5;
        }
        
        .settings-group:last-child {
            border-bottom: none;
        }
        
        .settings-header {
            display: flex;
            align-items: center;
            gap: var(--space-md);
            margin-bottom: var(--space-lg);
        }
        
        .settings-icon {
            width: 48px;
            height: 48px;
            background: linear-gradient(135deg, var(--sage-whisper), var(--sage-light));
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--forest-depth);
            font-size: 1.25rem;
            box-shadow: 0 4px 12px rgba(107, 142, 90, 0.15);
        }
        
        /* Form Controls */
        .form-row {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: var(--space-lg);
        }
        
        /* Success State */
        .success-message {
            background: rgba(103, 137, 72, 0.1);
            color: var(--success);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            display: flex;
            align-items: center;
            gap: var(--space-sm);
            margin-bottom: var(--space-lg);
        }
        
        /* Premium Badge Styles */
        .badge {
            display: inline-block;
            padding: 4px 8px;
            font-size: 0.75rem;
            font-weight: 600;
            border-radius: var(--radius-sm);
            margin-left: var(--space-xs);
        }
        
        .badge-secondary {
            background: linear-gradient(135deg, var(--sage-whisper), var(--sage-light));
            color: var(--forest-depth);
            border: 1px solid var(--sage-light);
        }
        
        .badge-info {
            background: linear-gradient(135deg, var(--forest-depth), var(--primary-light));
            color: var(--white);
            box-shadow: 0 2px 8px rgba(107, 142, 90, 0.3);
        }
        
        .badge-warning {
            background: rgba(243, 156, 18, 0.1);
            color: rgb(243, 156, 18);
        }
        
        .badge-success {
            background: rgba(46, 204, 113, 0.1);
            color: rgb(46, 204, 113);
        }
        
        /* Toast */
        .toast {
            position: fixed;
            bottom: var(--space-xl);
            right: var(--space-xl);
            background: var(--dark);
            color: var(--white);
            padding: var(--space-md) var(--space-lg);
            border-radius: var(--radius-md);
            box-shadow: var(--shadow-lg);
            display: none;
            animation: slideUp 0.3s ease-out;
        }
        
        .toast.show {
            display: block;
        }
        
        .toast.error {
            background: var(--error);
        }
        
        @keyframes slideUp {
            from {
                transform: translateY(100%);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }
    </style>
</head>
<body>
    <!-- Header -->
    <header class="platform-header">
        <div class="container">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <a href="/" class="logo premium-glow">
                    <img src="/images/logo.png" alt="SenbirdTea" class="logo-img" style="filter: hue-rotate(45deg) saturate(0.8);">
                    <div class="logo-text">
                        <span style="background: linear-gradient(135deg, var(--forest-depth), var(--sage-mist)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;">SENBIRD</span>
                    </div>
                </a>
                <div style="display: flex; align-items: center; gap: var(--space-lg);">
                    <span class="text-muted">Interview Management System</span>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Main Dashboard -->
    <div class="dashboard-layout">
        <!-- Sidebar Navigation -->
        <nav class="sidebar-nav">
            <div class="nav-item active" onclick="showSection('templates')">
                <i class="fas fa-briefcase"></i>
                <span>Position Templates</span>
            </div>
            <div class="nav-item" onclick="showSection('interviews')">
                <i class="fas fa-users"></i>
                <span>Interviews</span>
            </div>
            <div class="nav-item" onclick="showSection('settings')">
                <i class="fas fa-cog"></i>
                <span>Settings</span>
            </div>
        </nav>
        
        <!-- Main Content -->
        <div class="main-content">
            <!-- Position Templates Section -->
            <section class="content-section active" id="templatesSection">
                <div class="quick-actions">
                    <div>
                        <h3>Position Templates</h3>
                        <p>Create reusable templates with job descriptions and interview questions</p>
                    </div>
                    <button class="btn btn-white" onclick="showTemplateModal()">
                        <i class="fas fa-plus"></i> Create Template
                    </button>
                </div>
                
                <div id="templateGrid" class="template-grid">
                    <!-- Templates will be loaded here -->
                </div>
            </section>
            
            <!-- Interviews Section -->
            <section class="content-section" id="interviewsSection">
                <h2>Interview Dashboard</h2>
                <p class="text-muted mb-4">Track all scheduled, active, and completed interviews in one place</p>
                
                <div class="stats-widget">
                    <div class="stat-item">
                        <div class="stat-value" id="totalInterviews">0</div>
                        <div class="stat-label">Total Interviews</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="activeInterviews">0</div>
                        <div class="stat-label">Active</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="completedInterviews">0</div>
                        <div class="stat-label">Completed</div>
                    </div>
                </div>
                
                <div id="interviewsList" class="interview-list">
                    <!-- Interviews will be loaded here -->
                </div>
            </section>
            
            <!-- Settings Section -->
            <section class="content-section" id="settingsSection">
                <h2>System Configuration</h2>
                <p class="text-muted mb-4">Configure API keys and AI interview behavior</p>
                
                <form id="settingsForm">
                    <!-- API Configuration -->
                    <div class="settings-group">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-key"></i>
                            </div>
                            <div>
                                <h3>API Configuration</h3>
                                <p class="text-muted">Connect your AI services</p>
                            </div>
                        </div>
                        
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">OpenAI API Key</label>
                                <input type="password" class="form-control" id="openaiKey" placeholder="sk-...">
                                <small class="text-muted">Powers interview questions and analysis</small>
                            </div>
                            <div class="form-group">
                                <label class="form-label">ElevenLabs API Key</label>
                                <input type="password" class="form-control" id="elevenLabsKey" placeholder="Your API key">
                                <small class="text-muted">Enables AI voice synthesis</small>
                            </div>
                        </div>
                    </div>
                    
                    <!-- AI Interview Configuration -->
                    <div class="settings-group">
                        <div class="settings-header">
                            <div class="settings-icon">
                                <i class="fas fa-brain"></i>
                            </div>
                            <div>
                                <h3>AI Interview Configuration</h3>
                                <p class="text-muted">Customize voice and behavior for interviews</p>
                            </div>
                        </div>
                        
                        <!-- Voice Settings -->
                        <div class="form-group">
                            <label class="form-label">Interview Voice</label>
                            <select class="form-control" id="defaultVoice">
                                <option value="EXAVITQu4vr4xnSDxMaL">Rachel - Professional Female</option>
                                <option value="pNInz6obpgDQGcFmaJgB">Adam - Professional Male</option>
                                <option value="21m00Tcm4TlvDq8ikWAM">Domi - Warm Female</option>
                                <option value="AZnzlk1XvdvUeBnXmlld">Sam - Friendly Male</option>
                            </select>
                            <small class="text-muted">Select the AI voice for conducting interviews</small>
                        </div>
                        
                        <!-- Behavior Settings -->
                        <div class="form-row">
                            <div class="form-group">
                                <label class="form-label">Interview Style</label>
                                <select class="form-control" id="interviewStyle">
                                    <option value="professional">Professional</option>
                                    <option value="casual">Casual</option>
                                    <option value="friendly">Friendly</option>
                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Pace</label>
                                <select class="form-control" id="interviewPace">
                                    <option value="slow">Slow</option>
                                    <option value="normal">Normal</option>
                                    <option value="fast">Fast</option>
                                </select>
                            </div>
                        </div>
                        
                        <div class="form-group">
                            <label class="form-label">Custom Instructions</label>
                            <textarea class="form-control" id="customInstructions" rows="4" 
                                      placeholder="Any specific behavior instructions for the AI interviewer..."></textarea>
                            <small class="text-muted">E.g., "Ask follow-up questions when answers are brief", "Wait 3 seconds between questions"</small>
                        </div>
                    </div>
                    
                    <div class="text-center">
                        <button type="submit" class="btn btn-primary btn-lg">
                            <i class="fas fa-save"></i> Save Configuration
                        </button>
                    </div>
                </form>
            </section>
        </div>
    </div>
    
    <!-- Template Modal -->
    <div class="modal" id="templateModal">
        <div class="modal-content" style="max-width: 800px;">
            <button class="modal-close" onclick="closeTemplateModal()">
                <i class="fas fa-times"></i>
            </button>
            
            <h3 id="modalTitle">Create Position Template</h3>
            <p class="text-muted mb-4">Define everything needed for this position's interviews</p>
            
            <form id="templateForm">
                <input type="hidden" id="templateId">
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Position Title <span class="text-danger">*</span></label>
                        <input type="text" class="form-control" id="positionTitle" required>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Department</label>
                        <input type="text" class="form-control" id="department">
                    </div>
                </div>
                
                <div class="form-grid">
                    <div class="form-group">
                        <label class="form-label">Experience Level</label>
                        <select class="form-control" id="experienceLevel">
                            <option value="">Select level...</option>
                            <option value="entry">Entry Level</option>
                            <option value="mid">Mid Level</option>
                            <option value="senior">Senior Level</option>
                            <option value="lead">Lead/Principal</option>
                            <option value="executive">Executive</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label class="form-label">Duration (minutes)</label>
                        <input type="number" class="form-control" id="duration" value="30" min="15" max="120">
                    </div>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Job Description <span class="text-danger">*</span></label>
                    <textarea class="form-control" id="jobDescription" rows="6" required></textarea>
                    <button type="button" class="btn btn-sm btn-secondary mt-2" onclick="generateDescription()">
                        <i class="fas fa-magic"></i> Generate with AI
                    </button>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Interview Questions</label>
                    <div id="questionsContainer">
                        <!-- Questions will be added here -->
                    </div>
                    <button type="button" class="btn btn-sm btn-secondary" onclick="addQuestion()">
                        <i class="fas fa-plus"></i> Add Question
                    </button>
                </div>
                
                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary">Save Template</button>
                    <button type="button" class="btn btn-secondary" onclick="closeTemplateModal()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Quick Interview Modal -->
    <div class="interview-modal" id="quickInterviewModal">
        <div class="interview-modal-content">
            <h3>Schedule Interview</h3>
            <p class="text-muted mb-4">Enter candidate details to create interview link</p>
            
            <form id="quickInterviewForm">
                <input type="hidden" id="selectedTemplateId">
                
                <div class="form-group">
                    <label class="form-label">Position</label>
                    <input type="text" class="form-control" id="selectedPosition" readonly>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Candidate Name <span class="text-danger">*</span></label>
                    <input type="text" class="form-control" id="candidateName" required>
                </div>
                
                <div class="form-group">
                    <label class="form-label">Candidate Email <span class="text-danger">*</span></label>
                    <input type="email" class="form-control" id="candidateEmail" required>
                </div>
                
                <div class="text-center mt-4">
                    <button type="submit" class="btn btn-primary btn-lg">
                        <i class="fas fa-link"></i> Generate Interview Link
                    </button>
                    <button type="button" class="btn btn-secondary" onclick="closeQuickInterview()">Cancel</button>
                </div>
            </form>
        </div>
    </div>
    
    <!-- Success Modal -->
    <div class="modal" id="successModal">
        <div class="modal-content">
            <div class="text-center">
                <div class="success-icon" style="font-size: 3rem; color: var(--success); margin-bottom: var(--space-lg);">
                    <i class="fas fa-check-circle"></i>
                </div>
                <h3>Interview Link Created!</h3>
                <p class="text-muted mb-4">Share this link with the candidate</p>
                
                <div class="form-group">
                    <input type="text" class="form-control" id="interviewLink" readonly>
                </div>
                
                <button class="btn btn-primary" onclick="copyLink()">
                    <i class="fas fa-copy"></i> Copy Link
                </button>
                <button class="btn btn-secondary" onclick="closeSuccessModal()">Close</button>
            </div>
        </div>
    </div>
    
    <!-- Toast Notification -->
    <div class="toast" id="toast"></div>
    
    <!-- Premium Loading Overlay -->
    <div class="loading-overlay" id="loadingOverlay">
        <div class="loading-container">
            <div class="loading-icon" style="width: 80px; height: 80px; margin: 0 auto 20px; position: relative;">
                <div style="position: absolute; inset: 0; border-radius: 50%; border: 3px solid transparent; border-top-color: var(--forest-depth); animation: spin 1s linear infinite;"></div>
                <div style="position: absolute; inset: 0; border-radius: 50%; border: 3px solid transparent; border-bottom-color: var(--sage-mist); animation: spin 1.5s linear reverse infinite;"></div>
            </div>
            <p class="loading-text" style="color: var(--forest-depth); font-weight: 500; animation: pulse-opacity 1.5s ease-in-out infinite;">Creating your interview...</p>
        </div>
    </div>
    
    <style>
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            display: none;
            align-items: center;
            justify-content: center;
            z-index: 2000;
        }
        
        .loading-overlay.active {
            display: flex;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        @keyframes pulse-opacity {
            0%, 100% { opacity: 0.6; }
            50% { opacity: 1; }
        }
    </style>
    
    <script>
        // State Management
        let templates = [];
        let interviews = [];
        let currentSection = 'templates';
        
        // Initialize
        document.addEventListener('DOMContentLoaded', () => {
            loadTemplates();
            loadInterviews();
            loadSettings();
        });
        
        // Navigation
        function showSection(section) {
            // Update nav
            document.querySelectorAll('.nav-item').forEach(item => {
                item.classList.remove('active');
            });
            event.target.closest('.nav-item').classList.add('active');
            
            // Update content
            document.querySelectorAll('.content-section').forEach(section => {
                section.classList.remove('active');
            });
            document.getElementById(section + 'Section').classList.add('active');
            
            currentSection = section;
        }
        
        // Template Management
        async function loadTemplates() {
            try {
                const response = await fetch('/api/templates');
                templates = await response.json();
                renderTemplates();
            } catch (error) {
                console.error('Error loading templates:', error);
            }
        }
        
        function renderTemplates() {
            const grid = document.getElementById('templateGrid');
            
            if (templates.length === 0) {
                grid.innerHTML = `
                    <div style="grid-column: 1/-1; text-align: center; padding: 60px;">
                        <i class="fas fa-folder-open" style="font-size: 4rem; color: var(--dark-20); display: block; margin-bottom: 20px;"></i>
                        <h3 style="color: var(--dark); margin-bottom: var(--space-sm);">No Templates Yet</h3>
                        <p class="text-muted">Create your first position template to start scheduling interviews</p>
                        <button class="btn btn-primary mt-3" onclick="showTemplateModal()">
                            <i class="fas fa-plus"></i> Create Template
                        </button>
                    </div>
                `;
                return;
            }
            
            grid.innerHTML = templates.map(template => `
                <div class="template-card">
                    <div class="template-card-header">
                        <h3 class="template-card-title">${template.position}</h3>
                        ${template.department ? `<span class="badge badge-secondary">${template.department}</span>` : ''}
                        ${template.level ? `<span class="badge badge-info">${getLevelLabel(template.level)}</span>` : ''}
                    </div>
                    
                    <div class="template-card-meta">
                        <span><i class="fas fa-question-circle"></i> ${template.questions.length} questions</span>
                        <span><i class="fas fa-clock"></i> ${template.duration || 30} min</span>
                    </div>
                    
                    <div class="template-card-description">
                        ${(template.jobDescription || '').substring(0, 150)}...
                    </div>
                    
                    <div class="template-card-actions">
                        <button class="btn btn-primary" onclick="quickInterview('${template.id}')">
                            <i class="fas fa-user-plus"></i> Interview Candidate
                        </button>
                        <button class="btn btn-secondary btn-sm" onclick="editTemplate('${template.id}')">
                            <i class="fas fa-edit"></i>
                        </button>
                        <button class="btn btn-light btn-sm" onclick="deleteTemplate('${template.id}')">
                            <i class="fas fa-trash"></i>
                        </button>
                    </div>
                </div>
            `).join('');
        }
        
        // Quick Interview Creation
        function quickInterview(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;
            
            document.getElementById('selectedTemplateId').value = templateId;
            document.getElementById('selectedPosition').value = template.position;
            document.getElementById('quickInterviewModal').classList.add('active');
        }
        
        function closeQuickInterview() {
            document.getElementById('quickInterviewModal').classList.remove('active');
            document.getElementById('quickInterviewForm').reset();
        }
        
        // Interview Management
        async function loadInterviews() {
            try {
                const response = await fetch('/api/interviews');
                interviews = await response.json();
                renderInterviews();
                updateStats();
            } catch (error) {
                console.error('Error loading interviews:', error);
            }
        }
        
        function renderInterviews() {
            const list = document.getElementById('interviewsList');
            
            if (interviews.length === 0) {
                list.innerHTML = `
                    <div class="text-center" style="padding: var(--space-2xl);">
                        <i class="fas fa-calendar-times" style="font-size: 3rem; color: var(--dark-30); margin-bottom: var(--space-lg);"></i>
                        <p class="text-muted">No interviews scheduled yet</p>
                        <p class="text-muted">Create a template and schedule your first interview</p>
                    </div>`;
                return;
            }
            
            list.innerHTML = interviews.map(interview => `
                <div class="interview-item">
                    <div>
                        <strong>${interview.candidateName}</strong>
                        <span class="text-muted">- ${interview.role}</span>
                        <br>
                        <small class="text-muted">${formatDate(interview.createdAt)}</small>
                    </div>
                    <div>
                        ${getStatusBadge(interview.status)}
                        ${interview.status === 'completed' ? 
                            `<a href="/results/${interview.id}" class="btn btn-sm btn-success ml-2">View Results</a>` :
                            `<button class="btn btn-sm btn-secondary ml-2" onclick="copyInterviewLink('${interview.id}')">Copy Link</button>`
                        }
                    </div>
                </div>
            `).join('');
        }
        
        function updateStats() {
            document.getElementById('totalInterviews').textContent = interviews.length;
            document.getElementById('activeInterviews').textContent = interviews.filter(i => i.status === 'active').length;
            document.getElementById('completedInterviews').textContent = interviews.filter(i => i.status === 'completed').length;
        }
        
        // Settings
        async function loadSettings() {
            try {
                const response = await fetch('/api/settings/check');
                const settings = await response.json();
                
                if (settings.openai) {
                    document.getElementById('openaiKey').placeholder = 'API key configured';
                }
                if (settings.elevenlabs) {
                    document.getElementById('elevenLabsKey').placeholder = 'API key configured';
                }
                
                // Load guidelines
                const guidelinesResponse = await fetch('/api/settings/guidelines');
                const guidelines = await guidelinesResponse.json();
                
                if (guidelines.success) {
                    document.getElementById('interviewStyle').value = guidelines.guidelines.style;
                    document.getElementById('interviewPace').value = guidelines.guidelines.pace;
                    document.getElementById('customInstructions').value = guidelines.guidelines.customInstructions;
                }
            } catch (error) {
                console.error('Error loading settings:', error);
            }
        }
        
        // Form Handlers
        document.getElementById('settingsForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const settings = {
                openai_api_key: document.getElementById('openaiKey').value,
                elevenlabs_api_key: document.getElementById('elevenLabsKey').value,
                elevenlabs_voice_id: document.getElementById('defaultVoice').value,
                interview_guidelines: {
                    style: document.getElementById('interviewStyle').value,
                    pace: document.getElementById('interviewPace').value,
                    customInstructions: document.getElementById('customInstructions').value,
                    followUpFrequency: 0.3,
                    waitTime: 2000,
                    maxFollowUps: 2
                }
            };
            
            try {
                const response = await fetch('/api/settings/save', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(settings)
                });
                
                if (response.ok) {
                    showToast('Settings saved successfully!');
                }
            } catch (error) {
                console.error('Error saving settings:', error);
                showToast('Failed to save settings', 'error');
            }
        });
        
        document.getElementById('quickInterviewForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const templateId = document.getElementById('selectedTemplateId').value;
            const template = templates.find(t => t.id === templateId);
            
            const data = {
                candidateName: document.getElementById('candidateName').value,
                candidateEmail: document.getElementById('candidateEmail').value,
                role: template.position,
                jobDescription: template.jobDescription,
                customQuestions: template.questions,
                templateData: template
            };
            
            try {
                const response = await fetch('/api/interviews/create', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(data)
                });
                
                const result = await response.json();
                
                if (result.success) {
                    closeQuickInterview();
                    document.getElementById('interviewLink').value = result.interviewUrl;
                    document.getElementById('successModal').classList.add('active');
                    loadInterviews();
                }
            } catch (error) {
                console.error('Error creating interview:', error);
                showToast('Failed to create interview', 'error');
            }
        });
        
        // Utility Functions
        function showToast(message, type = 'success') {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.className = 'toast show ' + type;
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
        
        function getLevelLabel(level) {
            const labels = {
                'entry': 'Entry Level',
                'mid': 'Mid Level',
                'senior': 'Senior Level',
                'lead': 'Lead/Principal',
                'executive': 'Executive'
            };
            return labels[level] || level;
        }
        
        function formatDate(dateString) {
            return new Date(dateString).toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric',
                hour: '2-digit',
                minute: '2-digit'
            });
        }
        
        function getStatusBadge(status) {
            const badges = {
                pending: '<span class="badge badge-warning">Pending</span>',
                active: '<span class="badge badge-info">Active</span>',
                completed: '<span class="badge badge-success">Completed</span>'
            };
            return badges[status] || '';
        }
        
        function copyLink() {
            const input = document.getElementById('interviewLink');
            input.select();
            document.execCommand('copy');
            showToast('Link copied to clipboard!');
        }
        
        function closeSuccessModal() {
            document.getElementById('successModal').classList.remove('active');
        }
        
        // Template Modal Functions
        function showTemplateModal() {
            document.getElementById('templateModal').classList.add('active');
            document.getElementById('modalTitle').textContent = 'Create Position Template';
            document.getElementById('templateForm').reset();
            document.getElementById('templateId').value = '';
        }
        
        function closeTemplateModal() {
            document.getElementById('templateModal').classList.remove('active');
        }
        
        function editTemplate(templateId) {
            const template = templates.find(t => t.id === templateId);
            if (!template) return;
            
            document.getElementById('modalTitle').textContent = 'Edit Position Template';
            document.getElementById('templateId').value = template.id;
            document.getElementById('positionTitle').value = template.position;
            document.getElementById('department').value = template.department || '';
            document.getElementById('experienceLevel').value = template.level || '';
            document.getElementById('duration').value = template.duration || 30;
            document.getElementById('jobDescription').value = template.jobDescription || '';
            
            // Load questions
            const container = document.getElementById('questionsContainer');
            container.innerHTML = template.questions.map((q, i) => `
                <div class="form-group">
                    <input type="text" class="form-control" value="${q}" placeholder="Question ${i + 1}">
                </div>
            `).join('');
            
            document.getElementById('templateModal').classList.add('active');
        }
        
        async function deleteTemplate(templateId) {
            if (!confirm('Delete this template?')) return;
            
            try {
                const response = await fetch(`/api/templates/${templateId}`, {
                    method: 'DELETE'
                });
                
                if (response.ok) {
                    await loadTemplates();
                    showToast('Template deleted');
                }
            } catch (error) {
                console.error('Error deleting template:', error);
            }
        }
        
        function addQuestion() {
            const container = document.getElementById('questionsContainer');
            const questionDiv = document.createElement('div');
            questionDiv.className = 'form-group';
            questionDiv.innerHTML = `
                <input type="text" class="form-control" placeholder="Enter interview question">
            `;
            container.appendChild(questionDiv);
        }
        
        // Template form submission
        document.getElementById('templateForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const questions = Array.from(document.querySelectorAll('#questionsContainer input'))
                .map(input => input.value.trim())
                .filter(q => q.length > 0);
                
            const templateData = {
                position: document.getElementById('positionTitle').value,
                department: document.getElementById('department').value,
                level: document.getElementById('experienceLevel').value,
                duration: parseInt(document.getElementById('duration').value) || 30,
                jobDescription: document.getElementById('jobDescription').value,
                questions: questions.length > 0 ? questions : [
                    "Tell me about yourself and your professional background.",
                    "What interests you most about this role?",
                    "Describe a challenging project you've worked on recently.",
                    "How do you handle feedback and criticism?",
                    "Where do you see yourself professionally in 5 years?"
                ]
            };
            
            const templateId = document.getElementById('templateId').value;
            
            try {
                let response;
                if (templateId) {
                    response = await fetch(`/api/templates/${templateId}`, {
                        method: 'PUT',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(templateData)
                    });
                } else {
                    response = await fetch('/api/templates', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(templateData)
                    });
                }
                
                if (response.ok) {
                    closeTemplateModal();
                    await loadTemplates();
                    showToast(templateId ? 'Template updated!' : 'Template created!');
                }
            } catch (error) {
                console.error('Error saving template:', error);
                showToast('Failed to save template', 'error');
            }
        });
        
        // Generate job description with AI
        async function generateDescription() {
            const position = document.getElementById('positionTitle').value;
            const department = document.getElementById('department').value;
            const experienceLevel = document.getElementById('experienceLevel').value || 'mid';
            
            if (!position) {
                showToast('Please enter a position title first', 'error');
                return;
            }
            
            const button = event.target;
            button.disabled = true;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Generating...';
            
            try {
                const response = await fetch('/api/generate-suggestions', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ position, department, experienceLevel })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('jobDescription').value = data.jobDescription;
                    
                    // Also populate questions if empty
                    const container = document.getElementById('questionsContainer');
                    if (container.children.length === 0) {
                        container.innerHTML = data.suggestedQuestions.map(q => `
                            <div class="form-group">
                                <input type="text" class="form-control" value="${q}">
                            </div>
                        `).join('');
                    }
                    
                    showToast('Generated job description and questions!');
                }
            } catch (error) {
                console.error('Error generating description:', error);
                showToast('Failed to generate description', 'error');
            } finally {
                button.disabled = false;
                button.innerHTML = '<i class="fas fa-magic"></i> Generate with AI';
            }
        }
        
        // Copy interview link functionality
        function copyInterviewLink(interviewId) {
            const interview = interviews.find(i => i.id === interviewId);
            if (!interview) return;
            
            const url = window.location.origin + interview.interviewUrl;
            
            // Create temporary input to copy
            const input = document.createElement('input');
            input.value = url;
            document.body.appendChild(input);
            input.select();
            document.execCommand('copy');
            document.body.removeChild(input);
            
            showToast('Interview link copied!');
        }
        
        // Auto-refresh
        setInterval(() => {
            if (currentSection === 'interviews') {
                loadInterviews();
            }
        }, 30000);
    </script>
</body>
</html>
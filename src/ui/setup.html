<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Platform Setup - AI Interview Platform</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            margin: 0;
            padding: 0;
            background-color: #f5f5f5;
        }
        .setup-container {
            max-width: 800px;
            margin: 40px auto;
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            overflow: hidden;
        }
        .setup-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 40px;
            text-align: center;
        }
        .setup-header h1 {
            margin: 0 0 10px 0;
            font-size: 32px;
        }
        .setup-header p {
            margin: 0;
            opacity: 0.9;
        }
        .setup-progress {
            display: flex;
            padding: 30px 40px;
            border-bottom: 1px solid #e0e0e0;
        }
        .progress-step {
            flex: 1;
            text-align: center;
            position: relative;
        }
        .progress-step:not(:last-child)::after {
            content: '';
            position: absolute;
            top: 15px;
            right: -50%;
            width: 100%;
            height: 2px;
            background: #e0e0e0;
        }
        .progress-step.completed::after {
            background: #4caf50;
        }
        .progress-circle {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            background: #e0e0e0;
            margin: 0 auto 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
            color: white;
        }
        .progress-step.active .progress-circle {
            background: #667eea;
        }
        .progress-step.completed .progress-circle {
            background: #4caf50;
        }
        .setup-content {
            padding: 40px;
        }
        .setup-section {
            display: none;
        }
        .setup-section.active {
            display: block;
        }
        .form-group {
            margin-bottom: 25px;
        }
        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: #333;
        }
        .form-group input, .form-group textarea {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            font-size: 16px;
            box-sizing: border-box;
        }
        .form-group textarea {
            min-height: 150px;
            resize: vertical;
        }
        .form-group .help-text {
            font-size: 14px;
            color: #666;
            margin-top: 5px;
        }
        .api-key-group {
            position: relative;
        }
        .api-key-group input {
            padding-right: 100px;
        }
        .test-btn {
            position: absolute;
            right: 10px;
            top: 35px;
            padding: 8px 16px;
            background: #e0e0e0;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
        }
        .test-btn:hover {
            background: #d0d0d0;
        }
        .test-btn.testing {
            background: #2196f3;
            color: white;
        }
        .test-btn.success {
            background: #4caf50;
            color: white;
        }
        .test-btn.error {
            background: #f44336;
            color: white;
        }
        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 30px;
        }
        .btn {
            padding: 12px 24px;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            transition: all 0.3s;
        }
        .btn-primary {
            background: #667eea;
            color: white;
        }
        .btn-primary:hover {
            background: #5a5ec9;
        }
        .btn-secondary {
            background: #e0e0e0;
            color: #333;
        }
        .btn-secondary:hover {
            background: #d0d0d0;
        }
        .alert {
            padding: 12px 20px;
            border-radius: 6px;
            margin-bottom: 20px;
            display: none;
        }
        .alert.success {
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #4caf50;
        }
        .alert.error {
            background: #ffebee;
            color: #c62828;
            border: 1px solid #f44336;
        }
        .service-card {
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
        }
        .service-card h3 {
            margin: 0 0 15px 0;
            color: #333;
        }
        .service-status {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 14px;
            margin-left: 10px;
        }
        .service-status.connected {
            background: #e8f5e9;
            color: #2e7d32;
        }
        .service-status.not-connected {
            background: #ffebee;
            color: #c62828;
        }
    </style>
</head>
<body>
    <div class="setup-container">
        <div class="setup-header">
            <h1>Welcome to AI Interview Platform</h1>
            <p>Let's set up your platform in just a few steps</p>
        </div>

        <div class="setup-progress">
            <div class="progress-step active" data-step="1">
                <div class="progress-circle">1</div>
                <div>Basic Info</div>
            </div>
            <div class="progress-step" data-step="2">
                <div class="progress-circle">2</div>
                <div>API Keys</div>
            </div>
            <div class="progress-step" data-step="3">
                <div class="progress-circle">3</div>
                <div>Welcome Page</div>
            </div>
            <div class="progress-step" data-step="4">
                <div class="progress-circle">4</div>
                <div>Review</div>
            </div>
        </div>

        <div class="setup-content">
            <div id="alert" class="alert"></div>

            <!-- Step 1: Basic Information -->
            <div class="setup-section active" data-section="1">
                <h2>Basic Information</h2>
                <p>Let's start with some basic information about your organization.</p>
                
                <div class="form-group">
                    <label for="company_name">Company Name</label>
                    <input type="text" id="company_name" placeholder="Your Company Inc.">
                    <div class="help-text">This will appear in emails and on the platform</div>
                </div>

                <div class="form-group">
                    <label for="platform_name">Platform Name</label>
                    <input type="text" id="platform_name" placeholder="AI Interview Platform" value="AI Interview Platform">
                    <div class="help-text">The name candidates will see</div>
                </div>

                <div class="button-group">
                    <button class="btn btn-primary" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 2: API Configuration -->
            <div class="setup-section" data-section="2">
                <h2>API Configuration</h2>
                <p>Configure the services that power your interview platform. You can test each connection.</p>

                <div class="service-card">
                    <h3>Claude AI <span class="service-status not-connected" id="claude-status">Not Connected</span></h3>
                    <p>Powers the AI interviewer and evaluation system</p>
                    <div class="form-group api-key-group">
                        <label for="claude_api_key">Claude API Key</label>
                        <input type="password" id="claude_api_key" placeholder="sk-ant-...">
                        <button class="test-btn" onclick="testConnection('claude')">Test</button>
                        <div class="help-text">Get your key from <a href="https://console.anthropic.com/" target="_blank">console.anthropic.com</a></div>
                    </div>
                </div>

                <div class="service-card">
                    <h3>Google Services <span class="service-status not-connected" id="google-status">Not Connected</span></h3>
                    <p>Creates Google Meet rooms and manages recordings</p>
                    <div class="form-group">
                        <label for="google_credentials">Google Service Account JSON</label>
                        <textarea id="google_credentials" placeholder='{"type": "service_account", "project_id": "...", "private_key": "...", "client_email": "..."}'></textarea>
                        <button class="test-btn" onclick="testConnection('google')">Test</button>
                        <div class="help-text">Paste your entire service account JSON here</div>
                    </div>
                </div>

                <div class="service-card">
                    <h3>ElevenLabs <span class="service-status not-connected" id="elevenlabs-status">Optional</span></h3>
                    <p>Natural AI voice for interview questions</p>
                    <div class="form-group api-key-group">
                        <label for="elevenlabs_api_key">ElevenLabs API Key (Optional)</label>
                        <input type="password" id="elevenlabs_api_key" placeholder="Your API key">
                        <button class="test-btn" onclick="testConnection('elevenlabs')">Test</button>
                        <div class="help-text">Get your key from <a href="https://elevenlabs.io" target="_blank">elevenlabs.io</a></div>
                    </div>
                </div>

                <div class="service-card">
                    <h3>Recall.ai <span class="service-status not-connected" id="recall-status">Optional</span></h3>
                    <p>Records interview sessions automatically</p>
                    <div class="form-group api-key-group">
                        <label for="recall_api_key">Recall.ai API Key (Optional)</label>
                        <input type="password" id="recall_api_key" placeholder="Your API key">
                        <button class="test-btn" onclick="testConnection('recall')">Test</button>
                        <div class="help-text">Get your key from <a href="https://recall.ai" target="_blank">recall.ai</a></div>
                    </div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="previousStep()">Back</button>
                    <button class="btn btn-primary" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 3: Welcome Page -->
            <div class="setup-section" data-section="3">
                <h2>Customize Welcome Page</h2>
                <p>This is what candidates see when they visit your interview link.</p>

                <div class="form-group">
                    <label for="intro_content">Welcome Message (Markdown)</label>
                    <textarea id="intro_content" placeholder="# Welcome to Your Interview

We're excited to meet you!">
# Welcome to Your Interview

We're excited to get to know you better! This interview will be conducted by our AI assistant, Claude, who will guide you through a series of questions tailored to the role you're applying for.

## What to Expect

- **Duration**: 30-45 minutes
- **Format**: Video interview via Google Meet
- **Questions**: A mix of role-specific and behavioral questions

## Tips for Success

1. Find a quiet space with good lighting
2. Test your camera and microphone beforehand
3. Be yourself and let your personality shine through!

We look forward to speaking with you!</textarea>
                    <div class="help-text">Use Markdown formatting. This content is editable anytime from the admin dashboard.</div>
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="previousStep()">Back</button>
                    <button class="btn btn-primary" onclick="nextStep()">Next</button>
                </div>
            </div>

            <!-- Step 4: Review -->
            <div class="setup-section" data-section="4">
                <h2>Review & Launch</h2>
                <p>Great! Here's a summary of your configuration:</p>

                <div id="review-content">
                    <!-- Will be populated dynamically -->
                </div>

                <div class="button-group">
                    <button class="btn btn-secondary" onclick="previousStep()">Back</button>
                    <button class="btn btn-primary" onclick="completeSetup()">Complete Setup</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentStep = 1;
        const totalSteps = 4;

        function showAlert(message, type) {
            const alert = document.getElementById('alert');
            alert.className = `alert ${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        function updateProgress() {
            document.querySelectorAll('.progress-step').forEach((step, index) => {
                if (index < currentStep - 1) {
                    step.classList.add('completed');
                    step.classList.remove('active');
                } else if (index === currentStep - 1) {
                    step.classList.add('active');
                    step.classList.remove('completed');
                } else {
                    step.classList.remove('active', 'completed');
                }
            });

            document.querySelectorAll('.setup-section').forEach(section => {
                if (section.dataset.section == currentStep) {
                    section.classList.add('active');
                } else {
                    section.classList.remove('active');
                }
            });

            if (currentStep === 4) {
                showReview();
            }
        }

        function nextStep() {
            if (currentStep < totalSteps) {
                currentStep++;
                updateProgress();
            }
        }

        function previousStep() {
            if (currentStep > 1) {
                currentStep--;
                updateProgress();
            }
        }

        async function testConnection(service) {
            const btn = event.target;
            const originalText = btn.textContent;
            btn.textContent = 'Testing...';
            btn.className = 'test-btn testing';

            let apiKey = '';
            switch(service) {
                case 'claude':
                    apiKey = document.getElementById('claude_api_key').value;
                    break;
                case 'google':
                    apiKey = document.getElementById('google_credentials').value;
                    break;
                case 'elevenlabs':
                    apiKey = document.getElementById('elevenlabs_api_key').value;
                    break;
                case 'recall':
                    apiKey = document.getElementById('recall_api_key').value;
                    break;
            }

            try {
                const response = await fetch('/api/config/test', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ service, apiKey })
                });

                const result = await response.json();
                
                if (result.success) {
                    btn.textContent = '✓ Connected';
                    btn.className = 'test-btn success';
                    document.getElementById(`${service}-status`).className = 'service-status connected';
                    document.getElementById(`${service}-status`).textContent = 'Connected';
                } else {
                    btn.textContent = '✗ Failed';
                    btn.className = 'test-btn error';
                    showAlert(`${service} test failed: ${result.message}`, 'error');
                }
            } catch (error) {
                btn.textContent = '✗ Error';
                btn.className = 'test-btn error';
                showAlert(`Connection test failed: ${error.message}`, 'error');
            }

            setTimeout(() => {
                btn.textContent = originalText;
                btn.className = 'test-btn';
            }, 3000);
        }

        function showReview() {
            const review = document.getElementById('review-content');
            const config = {
                company_name: document.getElementById('company_name').value || 'Not set',
                platform_name: document.getElementById('platform_name').value || 'AI Interview Platform',
                claude: document.getElementById('claude_api_key').value ? '✓ Configured' : '✗ Not configured',
                google: document.getElementById('google_credentials').value ? '✓ Configured' : '✗ Not configured',
                elevenlabs: document.getElementById('elevenlabs_api_key').value ? '✓ Configured' : 'Not configured (optional)',
                recall: document.getElementById('recall_api_key').value ? '✓ Configured' : 'Not configured (optional)'
            };

            review.innerHTML = `
                <div class="service-card">
                    <h3>Basic Information</h3>
                    <p><strong>Company:</strong> ${config.company_name}</p>
                    <p><strong>Platform Name:</strong> ${config.platform_name}</p>
                </div>
                <div class="service-card">
                    <h3>API Services</h3>
                    <p><strong>Claude AI:</strong> ${config.claude}</p>
                    <p><strong>Google Services:</strong> ${config.google}</p>
                    <p><strong>ElevenLabs:</strong> ${config.elevenlabs}</p>
                    <p><strong>Recall.ai:</strong> ${config.recall}</p>
                </div>
                <div class="service-card">
                    <h3>Welcome Page</h3>
                    <p>✓ Customized and ready</p>
                </div>
            `;
        }

        async function completeSetup() {
            const config = {
                company_name: document.getElementById('company_name').value,
                platform_name: document.getElementById('platform_name').value,
                intro_content: document.getElementById('intro_content').value,
                claude_api_key: document.getElementById('claude_api_key').value,
                google_credentials: document.getElementById('google_credentials').value,
                elevenlabs_api_key: document.getElementById('elevenlabs_api_key').value,
                recall_api_key: document.getElementById('recall_api_key').value
            };

            try {
                const response = await fetch('/api/config/complete-setup', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(config)
                });

                if (response.ok) {
                    showAlert('Setup completed successfully! Redirecting to admin dashboard...', 'success');
                    setTimeout(() => {
                        window.location.href = '/admin';
                    }, 2000);
                } else {
                    showAlert('Setup failed. Please try again.', 'error');
                }
            } catch (error) {
                showAlert('Error completing setup: ' + error.message, 'error');
            }
        }

        // Initialize
        updateProgress();
    </script>
</body>
</html>